<div class="max-w-4xl mx-auto bg-white" *ngIf="user">
  <!-- Header del profilo -->
  <div class="relative mb-8">
    <div class="h-48 overflow-hidden rounded-t-xl">
      <img
        [src]="getUserCover()"
        alt="Cover photo"
        class="w-full h-full object-cover"
        (error)="onCoverError($event)"
      />
    </div>
    <div class="relative px-6 md:px-8 pb-5 bg-white rounded-b-xl shadow-lg">
      <div class="absolute -top-12 left-6 md:left-8">
        <img
          [src]="getUserAvatar()"
          [alt]="user.username"
          class="w-24 h-24 rounded-full border-4 border-white object-cover shadow-lg"
          (error)="onAvatarError($event)"
        />
      </div>
      <div class="mt-16">
        <h1 class="text-2xl font-bold text-gray-800 mb-1">
          {{ user.firstName }} {{ user.lastName }}
        </h1>
        <p class="text-gray-600 text-base mb-3">&#64;{{ user.username }}</p>
        <p *ngIf="user.bio" class="text-gray-800 leading-relaxed my-3">
          {{ user.bio }}
        </p>
        <div class="flex gap-8 my-5">
          <div class="flex flex-col items-center">
            <span class="text-xl font-bold text-gray-800">{{
              userPosts.length
            }}</span>
            <span class="text-sm text-gray-600 mt-1">Post</span>
          </div>
          <div class="flex flex-col items-center">
            <span class="text-xl font-bold text-gray-800">{{
              followersCount
            }}</span>
            <span class="text-sm text-gray-600 mt-1">Follower</span>
          </div>
          <div class="flex flex-col items-center">
            <span class="text-xl font-bold text-gray-800">{{
              followingCount
            }}</span>
            <span class="text-sm text-gray-600 mt-1">Following</span>
          </div>
        </div>
        <div class="mt-5" *ngIf="!isOwnProfile">
          <button
            (click)="toggleFollow()"
            class="px-5 py-2.5 rounded-full font-semibold cursor-pointer transition-all duration-300 disabled:opacity-60 disabled:cursor-not-allowed"
            [class]="
              isFollowing
                ? 'bg-green-500 text-white hover:bg-red-500'
                : 'bg-blue-500 text-white hover:bg-blue-600'
            "
            [disabled]="isFollowLoading"
          >
            {{ isFollowing ? 'Smetti di seguire' : 'Segui' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Informazioni aggiuntive -->
  <div class="bg-white p-5 rounded-xl mb-8 shadow-lg mx-2 md:mx-0">
    <div class="flex items-center mb-2.5 text-gray-600" *ngIf="user.location">
      <span class="mr-2.5 text-base">ğŸ“</span>
      <span>{{ user.location }}</span>
    </div>
    <div class="flex items-center mb-2.5 text-gray-600" *ngIf="user.website">
      <span class="mr-2.5 text-base">ğŸŒ</span>
      <a
        [href]="user.website"
        target="_blank"
        class="text-blue-500 no-underline hover:underline"
        >{{ user.website }}</a
      >
    </div>
    <div class="flex items-center mb-2.5 text-gray-600">
      <span class="mr-2.5 text-base">ğŸ“…</span>
      <span>Membro dal {{ formatDate(user.createdAt) }}</span>
    </div>
  </div>

  <!-- Post dell'utente -->
  <div class="bg-white p-5 rounded-xl shadow-lg mx-2 md:mx-0">
    <h2 class="text-xl font-semibold text-gray-800 mb-5">
      Post di {{ user.firstName || user.username }}
    </h2>
    <div *ngIf="isPostsLoading" class="text-center p-5 text-gray-600">
      Caricamento post...
    </div>
    <div
      *ngIf="!isPostsLoading && userPosts.length === 0"
      class="text-center p-5 text-gray-600"
    >
      <p>
        {{ user.firstName || user.username }} non ha ancora pubblicato nessun
        post.
      </p>
    </div>
    <div *ngIf="!isPostsLoading && userPosts.length > 0" class="space-y-4">
      <div
        *ngFor="let post of userPosts"
        class="border border-gray-200 rounded-lg p-4"
      >
        <div class="flex items-center mb-2.5">
          <img
            [src]="getUserAvatar()"
            [alt]="user.username"
            class="w-10 h-10 rounded-full mr-2.5 object-cover"
            (error)="onAvatarError($event)"
          />
          <div>
            <h4 class="text-sm font-medium text-gray-800 m-0">
              {{ user.firstName }} {{ user.lastName }}
            </h4>
            <span class="text-xs text-gray-600">{{
              formatDate(post.createdAt)
            }}</span>
          </div>
        </div>
        <div class="my-2.5 leading-relaxed">
          <p>{{ post.content }}</p>
        </div>
        <div class="flex gap-5 text-sm text-gray-600 mt-2.5">
          <span>ğŸ‘ {{ post.likesCount || 0 }}</span>
          <span>ğŸ’¬ {{ post.commentsCount || 0 }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading state -->
<div *ngIf="isLoading" class="text-center py-10 px-5">
  <p>Caricamento profilo...</p>
</div>

<!-- Error state -->
<div *ngIf="error" class="text-center py-10 px-5">
  <h2 class="text-xl font-semibold mb-3">Errore</h2>
  <p class="mb-4">{{ error }}</p>
  <button
    (click)="goBack()"
    class="bg-blue-500 text-white border-none px-5 py-2.5 rounded cursor-pointer hover:bg-blue-600 transition-colors"
  >
    Torna indietro
  </button>
</div>
